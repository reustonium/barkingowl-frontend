<html>
<head>
    <title>BarkingOwl Frontend</title>

    <style>

        body {
        }

        div.site-container {
            margin: auto;
            width: 800px;
            background: #F0F0F0;
            border: solid 1px #444444;
            border-radius: 8px;
            margin-top: 20px;
            padding: 16px 16px 16px 16px;
        }

        div.controls {
            width: 100%;
            height: 600px;
        }

        div.indent {
            padding-left: 50px;
        }

    </style>

</head>
<body>

    <div class="site-container">

       <div class="controls">

           <h3>URL Dispatch</h3>

           <div class="indent">
               <b>Upload CSV file:</b>
               </br>
               <form id="upload_form" action="upload_csv" method="post" enctype="multipart/form-data">
                   <input type="file" id="file" name="file" size="10"/>
                   <input type="submit" value="Upload CSV">
               </form>
               </br>
               <b>URL JSON:</b>
               <textarea id="urls_json" type="text" rows="18" cols="90">URL JSON Goes Here.</textarea>
               </br></br>
               <button onclick="submit_urls();">Submit URLs</button>
           </div>

           </br>
           <h3>System Control</h3>

           <div class="indent">
               <button onclick="shutdown_system();">Shutdown System</button>
           </div>

       </div> 

    </div>

    <script src="jquery-1.11.1.js"></script>
    <script src="jquery.form.js"></script>
    <script src="jquery.csv-0.71.js"></script>
    <script>

        $(document).ready(function() { 
            // bind 'myForm' and provide a simple callback function 
            $('#upload_form').ajaxForm(function( response ) { 

                $('#status_label').html( "Please wait ..." )

                var data = $.csv.toObjects( response );

                var json_data = JSON.stringify( data );

                $('#urls_json').val( json_data );

                $('#status_label').html( "" )                

            }); 
        });

        function upload_csv() {
            var filename = $("#file").val();
            $.ajax({
                type: "POST",
                url: "upload_csv",
                enctype: 'multipart/form-data',
                data: {
                    file: filename
                },
                success: function( response ) {
                    //alert("Data Uploaded: " + response);
                    $('urls_json').val( response );
                }
            });
        }

        function submit_urls() {
            urls = encodeURIComponent( $('#urls_json').val() );
            $.getJSON('set_urls.json?urls=' + urls, function( data ) {
                // todo: report success/failure
            });
        }

        function shutdown_system() {
            $.getJSON('shutdown_system.json', function( data ) {
                // todo: report success/failure
            });
        }

    </script>

</body>
</html>
